<!DOCTYPE html>

<head>
    <title>Journal</title>
    <link rel="stylesheet" href="./assets/core.css">
    </link>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="./favi.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Journal">
    <link rel="apple-touch-icon" href="./favi.png">
    <meta name="theme-color" content="#000000">
    <script>
        var dbn = 'JournalDB';
        var cur;
    </script>
    <script src="./assets/lib/enc.js"></script>
    <script src="./assets/code/fs.js"></script>
    <script src="./assets/lib/jq.js"></script>
</head>

<body>
    <div id="main">
        <p class="h2">Welcome - 1/3</p>
        <p>Enter an encryption PIN below. 6 digits required.</p>
        <p>Note: If you forget this PIN, all entries are lost.</p>
    </div>
    <div id="backup" class="hide">
        <p class="h2">Restore - 3/3</p>
        <p>You can optionally restore from another Journal.</p>
        <p>Your restore code is</p>
    </div>
    <div id="auth" class="hide">
        <p class="h2">Locked</p>
        <p>Enter your decryption PIN.</p>
    </div>
    <div id="home" class="hide">
        <p class="h2">Journal</p>
        <button class="b1" onclick="eraseall(true);">Erase Now</button><button class="b1" onclick="fesw('home', 'new');">New Entry</button>
        <div id="home2"></div>
    </div>
    <div id="new" class="hide">
        <p class="h2">New Entry</p>
        <p>Name your creation.</p>
        <input id="newi" placeholder="Name here"></input>
        <button class="b1" onclick="fesw('new', 'home');">Back</button><button class="b1"
            onclick="adde(document.getElementById('newi').value, '');fesw('new', 'home');">Create</button>
    </div>
    <div id="editor" class="hide">
        <div id="menubar">
            <img class="icon" src="./assets/img/x.svg" onclick="fesw('editor', 'home');"></img>
            <img class="icon" src="./assets/img/save.svg"
                onclick="fesw('editor', 'home');adde(cur, document.getElementById('journalarea').value);"></img>
            <img class="icon" src="./assets/img/tr.svg" onclick="dele(cur);fesw('editor', 'home');"></img>
        </div>
        <textarea id="journalarea" rows="10"></textarea>
    </div>
</body>
<script src="./assets/code/core.js"></script>
<script>
    async function load() {
        await initializeDB();
        const fucker = await readf('/system/check');
        if (fucker !== undefined) {
            fesw('main', 'auth');
        }
    }
    $(document).ready(load);
    function adjustTextareaRows() {
        const menubarHeight = document.getElementById('menubar').offsetHeight;
        const availableHeight = window.innerHeight - menubarHeight - 140;
        const lineHeight = 16;
        const rows = Math.floor(availableHeight / lineHeight);
        document.getElementById('journalarea').rows = rows;
    }

    window.addEventListener('resize', adjustTextareaRows);
    window.addEventListener('load', adjustTextareaRows);
</script>